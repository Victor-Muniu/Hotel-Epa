"use strict";(()=>{var e={};e.id=183,e.ids=[183],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},3384:(e,t,o)=>{o.r(t),o.d(t,{config:()=>u,default:()=>l,routeModule:()=>b});var n={};o.r(n),o.d(n,{default:()=>d});var r=o(1802),a=o(7153),s=o(6249),i=o(5754);async function d(e,t){if("POST"!==e.method)return t.setHeader("Allow","POST"),t.status(405).json({message:"Method Not Allowed"});try{let o=(0,i.S)();if(!o)return t.status(200).json({message:"Received. Configure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to store requests."});let n=e.body.first_name||null,r=e.body.last_name||null,a=e.body.rooms?Number(e.body.rooms):1,s=e.body.guests?Number(e.body.guests):1,d=e.body.children?Number(e.body.children):0,l=String(e.body.start_date||""),u=String(e.body.end_date||""),b=e=>/^\d{4}-\d{2}-\d{2}$/.test(e);if(!b(l)||!b(u))return t.status(400).json({message:"Invalid date format. Use YYYY-MM-DD."});let m=new Date().toISOString().slice(0,10);if(l<m)return t.status(400).json({message:"Check-in date cannot be in the past."});if(u<=l)return t.status(400).json({message:"Check-out must be after check-in."});let y=e.body.board_plan,c=[];if(Array.isArray(y))c=y;else if("string"==typeof y)try{c=JSON.parse(y)}catch{c=[]}let p=Array.from(new Set(c.map(e=>String(e.board_type||"").trim()).filter(Boolean))),f=String(e.body.type||""),_=("room"===f.toLowerCase()?e.body.board_type||null:f||e.body.board_type||null)||(p.length<=1?p[0]||null:"mixed"),g={room_id:e.body.room_id||null,first_name:n,last_name:r,email:e.body.email,phone:e.body.phone||null,start_date:e.body.start_date,end_date:e.body.end_date,guests:s,children:d,board_type:_||null,board_plan:c,total_price:e.body.total_price||null,currency:"USD",status:"pending",payment_status:"pending",notes:e.body.notes||null,created_at:new Date().toISOString()},{error:h}=await o.from("bookings").insert(g);if(h)throw h;let P={type:e.body.type,first_name:n,last_name:r,full_name:[n,r].filter(Boolean).join(" ")||e.body.full_name||null,email:e.body.email,phone:e.body.phone||null,start_date:e.body.start_date,end_date:e.body.end_date,guests:s,children:d,rooms:a,room:e.body.room||null,nationality:e.body.nationality||null,notes:e.body.notes||null,created_at:new Date().toISOString()},{error:S}=await o.from("booking_requests").insert(P);if(S)throw S;return t.status(200).json({message:"Booking confirmed! We will contact you soon with details."})}catch(e){return console.error("Booking error:",e),t.status(200).json({message:"Booking received. Please ensure the bookings and booking_requests tables exist with RLS allowing anon inserts."})}}let l=(0,s.l)(n,"default"),u=(0,s.l)(n,"config"),b=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/booking",pathname:"/api/booking",bundlePath:"",filename:""},userland:n})},5754:(e,t,o)=>{o.d(t,{S:()=>i});let n=require("@supabase/supabase-js"),r="https://uhxofvlffmkrlqvbisil.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoeG9mdmxmZm1rcmxxdmJpc2lsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzgxMDYsImV4cCI6MjA3MTAxNDEwNn0.ZQDbpQqWb8CVhAjWxdwPr3RH_wDQTChVDplQVd_NlEI",s=null;function i(){return s||r&&a&&(s=(0,n.createClient)(r,a)),s}},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=3384);module.exports=o})();