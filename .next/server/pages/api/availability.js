"use strict";(()=>{var e={};e.id=530,e.ids=[530],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1314:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>d,routeModule:()=>f});var o={};r.r(o),r.d(o,{default:()=>u});var a=r(1802),n=r(7153),i=r(6249),s=r(5754);function l(e){return"string"==typeof e?e.trim():""}async function u(e,t){if("POST"!==e.method)return t.setHeader("Allow","POST"),t.status(405).json({error:"Method Not Allowed"});try{let a=l(e.body.roomType||e.body.room_type||e.body.room||""),n=l(e.body.checkIn||e.body.check_in||e.body.startDate||e.body.start_date||""),i=l(e.body.checkOut||e.body.check_out||e.body.endDate||e.body.end_date||""),u=Number(e.body.rooms??e.body.quantity??1)||1;if(!a||!n||!i)return t.status(400).json({error:"roomType, checkIn, and checkOut are required"});let d=(0,s.S)();if(!d)return t.status(500).json({error:"Supabase not configured"});async function r(e){for(let t of[{table:"hotel_rooms",col:"type"},{table:"hotel_rooms",col:"room_type"},{table:"hotel_rooms",col:"name"}])try{let{data:r,error:o}=await e.from(t.table).select("id,status").eq(t.col,a).eq("status","available");if(!o&&Array.isArray(r)){let e=r.filter(e=>!e.status||"available"===e.status).map(e=>String(e.id));return{ids:e,count:e.length}}}catch(e){}return{ids:[],count:0}}async function o(e,t){for(let r of[{start:"check_in",end:"check_out"},{start:"start_date",end:"end_date"}])try{let o=e.from("room_reservations").select("*");o=o.or(`and(${r.start}.lte.${i},${r.end}.gte.${n})`),o=t.length>0?o.in("room_id",t):o.eq("room_type",a);let{data:s,error:l}=await o;if(!l&&Array.isArray(s)){let e=new Set;for(let t of s)null!=t.room_id&&e.add(String(t.room_id));return{rows:s,usedIds:e}}}catch(e){}return{rows:[],usedIds:new Set}}let{ids:c,count:f}=await r(d),{rows:m,usedIds:y}=await o(d,c),b=y.size>0?y.size:m.length,p=Math.max(0,f-b);return t.status(200).json({available:p>=u,remaining:p,capacity:f,requestedRooms:u})}catch(e){return t.status(500).json({error:"Failed to check availability"})}}let d=(0,i.l)(o,"default"),c=(0,i.l)(o,"config"),f=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/availability",pathname:"/api/availability",bundlePath:"",filename:""},userland:o})},5754:(e,t,r)=>{r.d(t,{S:()=>s});let o=require("@supabase/supabase-js"),a="https://uhxofvlffmkrlqvbisil.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoeG9mdmxmZm1rcmxxdmJpc2lsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzgxMDYsImV4cCI6MjA3MTAxNDEwNn0.ZQDbpQqWb8CVhAjWxdwPr3RH_wDQTChVDplQVd_NlEI",i=null;function s(){return i||a&&n&&(i=(0,o.createClient)(a,n)),i}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1314);module.exports=r})();